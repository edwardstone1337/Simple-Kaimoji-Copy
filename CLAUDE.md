# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

kaomoji.click is a static, data-driven kaomoji (Japanese emoticon) browser with one-click copy functionality. Built with vanilla HTML/CSS/JavaScript (no frameworks or build tools), the site consists of a main single-page app (`index.html`) and generated SEO landing pages (`/explore/`).

## Development Commands

### Local Development
```bash
python3 -m http.server 4173
# Open http://localhost:4173
```

### Regenerate SEO Pages
Run this whenever `kaomojis.json` changes or when template/shared component changes are made:
```bash
node scripts/generate-seo-pages.js
```

### Pre-Ship Validation
Run before committing or opening a PR:
```bash
./scripts/ship-check.sh
```

This validates:
- JS syntax (all `.js` files)
- SEO page consistency with `kaomojis.json`
- No em dashes in copy files
- Generated artifacts (`/explore/`, `sitemap.xml`) are committed

## Architecture

### Data Model (`kaomojis.json`)

Single source of truth with three top-level arrays:

- **`groups`**: Top-level navigation categories (e.g., "Positive Emotions", "Animals")
  - `{ "id": string, "label": string }`
- **`categories`**: Sub-navigation items, each belonging to a group (e.g., "Joy", "Cat")
  - `{ "id": string, "group": string, "label": string, "description": string }`
- **`kaomojis`**: The emoticons themselves
  - `{ "char": string, "categories": string[], "popular"?: boolean }`
  - A kaomoji can belong to multiple categories
  - `popular: true` includes it in the "Popular" section

### Two-Part Architecture

1. **Main App (`index.html` + `script.js`)**
   - Single-page experience with all kaomojis
   - Two-tier navigation: groups (sticky nav) + categories (sub-nav)
   - IntersectionObserver tracks scroll position to update active nav states
   - Category cards have frosted-glass treatment with animated conic gradient borders
   - One-click copy to clipboard with snackbar feedback

2. **SEO Pages (`/explore/`)**
   - Generated by `scripts/generate-seo-pages.js` from `kaomojis.json`
   - Static HTML files for crawlability and intent-specific URLs
   - Hub page (`/explore/`), group pages (`/explore/groups/{id}/`), category pages (`/explore/categories/{id}/`)
   - Share design tokens from `styles.css`
   - Include JSON-LD breadcrumbs and canonical URLs

### Rendering Flow

1. **Load**: Inline script in `<head>` sets theme from localStorage or prefers-color-scheme
2. **Fetch**: `script.js` fetches `kaomojis.json` on DOMContentLoaded
3. **Render**:
   - `renderNav()` builds sticky nav (Popular + groups)
   - `renderAllSections()` builds Popular section + group sections with category cards
   - `renderSubNav()` builds category sub-nav for current group
4. **Observe**: IntersectionObservers track sections and categories to update active nav states and scroll nav to center active link
5. **Interact**: Click kaomoji → copy to clipboard → show snackbar → track GA event

### Design System

All visual styling is driven by CSS custom properties in `styles.css`:

- **Primitive tokens**: `--p-color-*`, `--p-font-*`, `--p-space-*`, `--p-radius-*`
- **Semantic tokens**: `--s-color-bg-page`, `--s-color-text-primary`, etc.
- **Dark mode**: `[data-theme="dark"]` overrides semantic tokens
- **Animated elements**: Category cards use `@property --gradient-angle` for rotating conic borders; respects `prefers-reduced-motion`

Reference: `design-system.html` provides a live component gallery.

## Key Patterns

### Navigation State Management
- Two IntersectionObservers: one for group sections, one for category blocks
- Active section/category updates corresponding nav link and scrolls it to center
- Sub-nav is hidden when Popular section is in view
- `updateOverflowClasses()` adds `.has-overflow` to navs with horizontal scroll for CSS fade masks

### Clipboard Copy
- Uses `navigator.clipboard.writeText()` (requires secure context)
- Success: snackbar shows "{kaomoji} copied to clipboard" + GA event
- Failure: snackbar shows error message

### Theme Toggle
- Persists to localStorage as "light" or "dark"
- Updates `data-theme` attribute on `<html>`
- Updates `meta[name="theme-color"]` for browser chrome

### Sticky Nav Constraint
`.header-container` and `.nav-wrapper` must remain siblings — not wrapped in a shared parent. `.nav-wrapper` uses `position: sticky` which is constrained by its containing block. Visual continuity between header and nav is achieved via matching glass backgrounds, not structural nesting.

## Pre-Ship Checklist (Mandatory)

Before completing any task:
- [ ] Read all user-visible copy — no developer jargon, placeholder text, or "SEO" references
- [ ] Confirm GA tracking (G-JKEBQ0M6NQ) is present on any new or modified HTML pages
- [ ] Run `node scripts/generate-seo-pages.js` if any template or shared component changes were made
- [ ] Remove console.log and debug statements
- [ ] Verify changes don't break dark mode (even if dark mode isn't the focus)
- [ ] Run `./scripts/ship-check.sh` and confirm PASS
- [ ] Provide a status report listing every file modified, selectors/functions changed, and any concerns

## Design System Guardrails

- **Reuse tokens**: Use existing `--p-*` and `--s-*` tokens in `styles.css`; avoid ad hoc visual constants
- **Preserve accessibility**:
  - Skip link to main content
  - Visible focus states (`:focus-visible`)
  - Keyboard-operable controls
  - Reduced-motion support for animations
- **Maintain component patterns**: Refer to `design-system.html` for live component examples and usage
- **Button consistency**: Any new button-like interactive element must reuse shadow, hover, and active patterns from `.kaomoji-button` (solid shadow `0 4px 0`, jelly animation on hover, compressed shadow on active) unless explicitly specified otherwise. Reference `design-system.html` for the canonical component states before creating new interactive elements.

## SEO and UX Guardrails

- `index.html` is the primary product experience (interactive, feature-rich)
- `/explore/` pages are intent landing pages (crawlable, direct links back to main app)
- Use contextual internal links (related categories) instead of exhaustive link lists
- Copy must be human-readable and concise; avoid search-engine-only boilerplate

## Documentation Updates

When making changes, update:
- `DOCUMENTATION.md` for architecture/behavior changes
- `CHANGELOG.md` for user-visible changes
- This file (CLAUDE.md) for workflow or architectural patterns that future Claude instances should know
